/*******************************************************************************
 * Educational Online Test Delivery System 
 * Copyright (c) 2014 American Institutes for Research
 *   
 * Distributed under the AIR Open Source License, Version 1.0 
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/
package org.opentestsystem.tds.dailymain;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

import tds.dll.api.IDmDLL;

import AIR.Common.DB.AbstractConnectionManager;
//import AIR.Common.DB.RollbackConnectionManager;
import AIR.Common.DB.SQLConnection;

public class DailyMain // extends AbstractDAO
{
  static ApplicationContext         context               =
      new ClassPathXmlApplicationContext (new String[] { "root-context.xml" });
  
  private static Logger             _logger               = LoggerFactory.getLogger (DailyMain.class);
  private IDmDLL                    dll                   = null;

  //private DataSource                applicationDataSource = null;

  private AbstractConnectionManager connectionManager     = null;

  public static void main (String[] args)
  {
    try {
      _logger.info ("Starting dailyMain run");
      new DailyMain ()._main (args);
      _logger.info ("Finished dailyMain run");
    } catch (Exception e) {
      _logger.error (e.getMessage ());
      throw new RuntimeException (e);
    }
  }

  public void _main (String[] args) throws Exception
  {
    dll = (IDmDLL) context.getBean ("iDmDLL");
 
    //applicationDataSource = (DataSource) context.getBean ("applicationDataSource");
    //Connection connection = applicationDataSource.getConnection ();
    //SQLConnection conn = new SQLConnection (connection);
    
    connectionManager = (AbstractConnectionManager) context.getBean ("abstractConnectionManager");
    try (SQLConnection conn1 = connectionManager.getConnection ()) {
      dll._DailyMaintenance_SP (conn1);
    }

  }

}
